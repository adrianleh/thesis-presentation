\documentclass[usenames,dvipsnames]{beamer}
\usetheme[deutsch]{KIT}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{babel}
\usepackage{tikz,calc,ifthen}
\usepackage{mathtools}
\usepackage[normalem]{ulem}
\usepackage{graphicx}
\usepackage{minted}
\usetikzlibrary{positioning,calc,arrows,shapes}
\tikzset{
  every node/.style={transform shape},
  auto,
  block/.style={align=center,rectangle,draw,minimum height=20pt,minimum width=30pt},
  >=triangle 60,
  alt/.code args={<#1>#2#3}{%
      \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}}
  },
  beameralert/.style={alt=<#1>{color=green!80!black}{}},
  mythick/.style={line width=1.4pt}
}

\newcommand*{\maxwidthofm}[2]{\maxof{\widthof{$#1$}}{\widthof{$#2$}}}
\newcommand<>*{\robustaltm}[2]{
  \alt#3
  {\mathmakebox[\maxwidthofm{#1}{#2}]{#1}\vphantom{#1#2}}
    {\mathmakebox[\maxwidthofm{#1}{#2}]{#2}\vphantom{#1#2}}
}

\newcommand<>*{\nodealert}[1]{\only#2{\draw[overlay,mythick,color=green!80!black] (#1.north west) rectangle (#1.south east)}}

\title{Schleifenausrollen mit nicht konstanten Grenzen in FIRM}
\author{Adrian E. Lehmannn}
\subtitle{\insertauthor}
\institute[IPD]{Lehrstuhl Programmierparadigmen, IPD Snelting}
\date{32.13.2019}
\KITtitleimage{cover.png}

\begin{document}

\begin{frame}
  \maketitle
\end{frame}

\begin{frame}{Ausrollen}
  \begin{center}
    \inputminted{c}{code_snippets/01-00-const-bound.c}
  \end{center}
\end{frame}

\begin{frame}{Ausrollen}
  \begin{center}
    \inputminted{c}{code_snippets/01-01-const-bound-unrolled.c}
  \end{center}
\end{frame}

\begin{frame}{Ausrollen: Nicht konstante Grenze}
  \begin{center}
    \inputminted{c}{code_snippets/02-00-non-const-bound.c}
  \end{center}
\end{frame}

\begin{frame}{Ausrollen: Nicht konstante Grenze}
  \begin{center}
    \inputminted{c}{code_snippets/02-01-non-const-bound-unrolled.c}
  \end{center}
  $\hookrightarrow$ \texttt{length} $\in \{\only<2>{\color{red}} 1, 2, 3, \normalcolor 4,\only<2>{\color{red}} 5, 6\normalcolor \}$
\end{frame}

\begin{frame}{Ausrollen: Nicht konstante Grenze}
  \begin{center}
    \inputminted{c}{code_snippets/03-00-non-const-bound-unrolled-less.c}
  \end{center}
  $\hookrightarrow$ \texttt{length} $\in \{\only<2>{\color{orange}} 1, 2, 3, \normalcolor 4,\only<2>{\color{orange}} 5, 6\normalcolor \}$
\end{frame}

\begin{frame}{Nicht konstante Grenze: Naiver Ansatz}
  \begin{center}
    \inputminted{c}{code_snippets/04-00-non-const-bound-loop-fixup.c}
  \end{center}
  $\hookrightarrow$ \texttt{length} $\in \{\only<2>{\color{green}} 1, 2, 3, \normalcolor 4,\only<2>{\color{green}} 5, 6\normalcolor \}$
\end{frame}

\begin{frame}{Nicht konstante Grenze: Duff's device}
  \begin{center}
    \inputminted{c}{code_snippets/04-01-non-const-bound-duff-fixup.c}
  \end{center}
  $\hookrightarrow$ \texttt{length} $\in \{\only<2>{\color{green}} 1, 2, 3, \normalcolor 4,\only<2>{\color{green}} 5, 6\normalcolor \}$
\end{frame}

\begin{frame}{Nicht konstante Grenze: Allgemeine Schleife}
  \begin{center}
    \inputminted{c}{code_snippets/10-00-general-loop.c}
  \end{center}
  \begin{itemize}
    \item $f$ unroll factor
    \item $N$ loop invariant
    \item $c \in \lbrack \frac{t_{min}}{f + 1}, \frac{t_{max}}{f + 1} \rbrack$
  \end{itemize}
\end{frame}

\begin{frame}{Allgemeineer loop fixup}
  \begin{center}
    \inputminted{c}{code_snippets/11-00-general-loop-fixup.c}
  \end{center}
\end{frame}

\begin{frame}{Problem}
  \begin{center}
    \inputminted{c}{code_snippets/12-00-non-const-bound-loop-fixup-unsigned.c}
  \end{center}
  $\hookrightarrow$ \texttt{length} $\in \{\only<2>{\color{red}} 1, 2,\only<2>{\color{green}} 3, \normalcolor 4,\only<2>{\color{green}} 5, 6\normalcolor \}$
\end{frame}

\begin{frame}{Lösung}
  \begin{center}
    \inputminted{c}{code_snippets/13-00-general-loop-fixup-preheader.c}
  \end{center}
  $\hookrightarrow$ \texttt{length} $\in \{\only<2>{\color{green}} 1, 2, 3, \normalcolor 4,\only<2>{\color{green}} 5, 6\normalcolor \}$
\end{frame}

\begin{frame}{Allgemeineer duff fixup}
  \begin{center}
    \inputminted{c}{code_snippets/14-00-general-duff-fixup.c}
  \end{center}
  \begin{itemize}
    \item $c \in \lbrack \frac{t_{min}}{f + 1}, \frac{t_{max}}{f + 1} \rbrack$
  \end{itemize}
\end{frame}

\begin{frame}{Evalulation \& Überblick}
  \begin{itemize}
    \item LCSSA hilfreich
    \item BA Aebi, gute Grundlage\pause
    \item 16\% mehr Schleifen ausgerollt
    \item Kein Performancegewinn\pause
    \item >2.5 KLOC
    \item ca. 10 Beweise nötig
  \end{itemize}
\end{frame}

\begin{frame}{Zusammenfassung}
  \begin{itemize}
    \item Nicht konstante Grenze ausrollbar
    \item Grenze invariant, Inkrement konstant
    \item Fixup code entweder loop oder duff's
    \item Preheader für Randfälle
  \end{itemize}
\end{frame}
\end{document}
